<!-- Header avec image de fond -->
<div
  class="mb-5"
  style="
    background-image: url('https://firefox-settings-attachments.cdn.mozilla.net/main-workspace/newtab-wallpapers-v2/a205885e-194a-41f9-ae47-e7da66a74041.avif');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    height: 300px;
    position: relative;
  "
>
  <!-- Titre centré -->
  <div
    class="container h-100 d-flex align-items-center justify-content-center "
    style="position: relative; z-index: 1;"
  >
    <!-- Classe my-malt-header pour la couleur du texte (définie dans ton Sass) -->
    <h1 class="fw-bold">Explore our freelancer talents</h1>
  </div>
</div>

<div class="container mt-5 bg-light">
  <div class="row">
    <!-- Colonne de gauche : Filtres -->
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-white mb-4">
        <div class="card-body">
          <h5 class="fw-bold mb-3">Filters</h5>

          <!-- Formulaire de recherche et filtres -->
          <%= form_with url: freelancer_profiles_path, method: :get, local: true do %>
            <!-- Champ de recherche -->
            <div class="mb-3">
              <label for="query" class="form-label">Search</label>
              <div class="input-group">
                <span class="input-group-text bg-white border-end-0">
                  <i class="fas fa-search text-muted"></i>
                </span>
                <%= text_field_tag :query, params[:query], class: "form-control border-start-0", placeholder: "Rechercher (nom, compétence...)", onchange: "this.form.submit()" %>
              </div>
            </div>

            <!-- Filtre : Disponibilité -->
            <div class="mb-3">
              <label for="availability" class="form-label">Availability</label>
              <select
                name="availability_status"
                id="availability"
                class="form-select"
                onchange="this.form.submit()"
              >
                <option value="">All</option>
                <option value="available" <%= "selected" if params[:availability_status] == "available" %>>Available</option>
                <option value="busy" <%= "selected" if params[:availability_status] == "busy" %>>Busy</option>
                <option value="unavailable" <%= "selected" if params[:availability_status] == "unavailable" %>>Unavailable</option>
              </select>
            </div>

            <!-- Filtre : Expérience -->
            <div class="mb-3">
              <label for="experience" class="form-label">Experience</label>
              <select
                name="years_of_experience"
                id="experience"
                class="form-select"
                onchange="this.form.submit()"
              >
                <option value="">All</option>
                <option value="0-2 years" <%= "selected" if params[:years_of_experience] == "0-2 years" %>>0-2 years</option>
                <option value="3-7 years" <%= "selected" if params[:years_of_experience] == "3-7 years" %>>3-7 years</option>
                <option value="8-15 years" <%= "selected" if params[:years_of_experience] == "8-15 years" %>>8-15 years</option>
                <option value="16+ years" <%= "selected" if params[:years_of_experience] == "16+ years" %>>16+ years</option>
              </select>
            </div>

            <!-- Filtre : Language -->
            <div class="mb-3">
              <label for="language" class="form-label">Language</label>
              <select
                name="language"
                id="language"
                class="form-select"
                onchange="this.form.submit()"
              >
                <option value="">All</option>
                <option value="french" <%= "selected" if params[:language] == "french" %>>French</option>
                <option value="english" <%= "selected" if params[:language] == "english" %>>English</option>
                <option value="spanish" <%= "selected" if params[:language] == "spanish" %>>Spanish</option>
                <option value="italian" <%= "selected" if params[:language] == "italian" %>>Italian</option>
                <option value="german" <%= "selected" if params[:language] == "german" %>>German</option>
              </select>
            </div>

            <!-- Filtre : Skills -->
            <div class="mb-3">
              <label for="tech_skills" class="form-label">Tech Skills</label>
              <input
                type="text"
                name="tech_skills"
                id="tech_skills"
                class="form-control"
                placeholder="e.g. Ruby, React"
                value="<%= params[:tech_skills] %>"
                onchange="this.form.submit()"
              >
            </div>
            <i class="fa-solid fa-house"></i>

            <!-- Ajoutez ce bloc dans votre formulaire de recherche -->
            <div class="form-group mt-4 mb-5" data-controller="price-range-slider">
              <h5 class="mb-3">Tarif / jour</h5>

              <!-- Container pour le slider -->
              <div class="range-slider-container">
                <div class="price-range-slider" id="priceRangeSlider" data-price-range-slider-target="slider"></div>

                <!-- Affichage des valeurs -->
                <div class="d-flex justify-content-between mt-2">
                  <div class="min-price">
                    <span data-price-range-slider-target="minDisplay">125</span> € et -
                  </div>
                  <div class="max-price">
                    <span data-price-range-slider-target="maxDisplay">560</span> € et +
                  </div>
                </div>

                <!-- Champs cachés pour le formulaire -->
                <input type="hidden" name="min_price" data-price-range-slider-target="minInput" value="125">
                <input type="hidden" name="max_price" data-price-range-slider-target="maxInput" value="560">
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Colonne de droite : Liste des freelances -->
    <div class="col-md-9">
      <h2 class="fw-bold mb-3 my-3">All our talents</h2>
      <p class="lead mb-5">
        Browse through our community of skilled freelancers. Whether you're looking for a developer, a designer, or any other professional, you'll find the perfect match for your project right here.
      </p>

      <!-- Affichage des profils -->
      <% if @profiles.empty? %>
        <p>Aucun profil trouvé</p>
      <% else %>
        <div class="row mt-5 gy-4">
          <% @profiles.each do |profile| %>
            <div class="col-md-4">
              <div
                class="card mb-4 border-0 shadow-sm hover-card bg-white rounded-4"
                style="overflow: hidden; position: relative;"
              >
                <!-- Photo / Overlay -->
                <div class="position-relative" style="height: 200px;">
                  <%= image_tag(
                    "https://images.ctfassets.net/h6goo9gw1hh6/2sNZtFAWOdP1lmQ33VwRN3/24e953b920a9cd0ff2e1d587742a2472/1-intro-photo-final.jpg?w=1200&h=992&fl=progressive&q=70&fm=jpg",
                    alt: "Freelancer Photo",
                    style: "width: 100%; height: 100%; object-fit: cover;"
                  ) %>
                  <div
                    class="position-absolute top-0 start-0 w-100 h-100"
                    style="background-color: rgba(0,0,0,0.4);"
                  ></div>
                  <!-- Nom + Titre -->
                  <div
                    class="position-absolute bottom-0 start-0 text-white p-3"
                    style="z-index: 1;"
                  >
                    <h5 class="fw-bold mb-1">
                      <%= profile.user.first_name %> <%= profile.user.last_name %>
                    </h5>
                    <p class="text-light mb-0">
                      <%= profile.title %>
                    </p>
                  </div>
                </div>

                <!-- Corps de la carte, avec plus de padding -->
                <div class="card-body p-4">
                  <!-- Localisation -->
                  <p class="text-muted mb-3">
                    <i class="fa-solid fa-location-dot me-1"></i>
                    <%= profile.address %>
                  </p>

                  <!-- Tarif journalier (exemple) -->
                  <p class="fw-bold mb-3" style="">
                    <%= profile.hourly_rate.present? ? "Rs #{profile.hourly_rate} /jour" : "N/A" %>
                  </p>

                  <!-- Compétences (tags) -->
                  <% if profile.tech_skills.present? %>
                    <div class="mb-3">
                      <% profile.tech_skills.split(',').first(4).each do |skill| %>
                        <span class="badge bg-info text-primary me-2 mb-2"><%= skill.strip %></span>
                      <% end %>
                    </div>
                  <% end %>

                  <!-- Bouton voir le profil -->
                  <div class="mt-4 d-flex justify-content-center">
                    <%= link_to "Voir le profil", freelancer_profile_path(profile), class: "btn-pill-custom-red" %>
                  </div>
                </div>
              </div> <!-- Fin de la carte -->
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Footer -->
    <footer class="notion-footer py-5 bg-light">
        <div class="border-top mt-4 pt-4">
          <p class="text-muted text-center mb-0">&copy; 2025 MoFreelance. All rights reserved.</p>
        </div>
      </div>
    </footer>

</div>
